project(ConsoleControl C)
cmake_minimum_required(VERSION 3.5)

#set(CMAKE_VERBOSE_MAKEFILE TRUE)

# Don't allow to build in sources otherwise a makefile not generated by CMake can be overrided
set(CMAKE_DISABLE_SOURCE_CHANGES ON)
set(CMAKE_DISABLE_IN_SOURCE_BUILD ON)

# Place generated binaries in build/bin
set(
  CMAKE_RUNTIME_OUTPUT_DIRECTORY
  ${CMAKE_BINARY_DIR}/build/bin
)

# Place generated libs in build/lib
set(
  CMAKE_LIBRARY_OUTPUT_DIRECTORY
  ${CMAKE_BINARY_DIR}/build/lib
)
set(
  CMAKE_ARCHIVE_OUTPUT_DIRECTORY
  ${CMAKE_BINARY_DIR}/build/lib
)

# By default build in Release mode
if( NOT CMAKE_BUILD_TYPE )
	set(CMAKE_BUILD_TYPE "Release")
endif()

if(CMAKE_COMPILER_IS_GNUCC)
	include(cmake/gcc-settings.cmake)
endif()

# Disable compiler specific extensions
set(CMAKE_C_EXTENSIONS OFF)


if(CMAKE_BUILD_TYPE STREQUAL "Debug")
	set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -DLOGGER_ENABLED")
	message(STATUS "Debug mode: Logger enabled (LOGGER_ENABLED macro defined)")
endif()

include_directories(
  ${CMAKE_CURRENT_SOURCE_DIR}/ConsoleControl/include/
  ${CMAKE_CURRENT_SOURCE_DIR}/Logger/include/
  ${CMAKE_CURRENT_SOURCE_DIR}/Examples/include/
)

link_directories(
  ${CMAKE_BINARY_DIR}/build/lib/
)

message(STATUS "Sources preparation")
file(GLOB_RECURSE LIB_SOURCE_FILES
  "${CMAKE_CURRENT_SOURCE_DIR}/ConsoleControl/src/*"
  )
message(" -> Library sources prepared")
file(GLOB_RECURSE EXAMPLES_SOURCE_FILES
  "${CMAKE_CURRENT_SOURCE_DIR}/Examples/src/*"
  )
message(" -> Examples sources prepared")

add_library(
  ConsoleControl
  STATIC
  ${LIB_SOURCE_FILES}
)
target_link_libraries(ConsoleControl m)

set_property(TARGET ConsoleControl PROPERTY C_STANDARD 11)
set_property(TARGET ConsoleControl PROPERTY C_STANDARD_REQUIRED ON)
message(STATUS "ConsoleControl set standard to use: c11")

add_executable(
  ConsoleControlExamples
  ${EXAMPLES_SOURCE_FILES}
)
add_dependencies(ConsoleControlExamples ConsoleControl)
target_link_libraries(ConsoleControlExamples ConsoleControl)

set_property(TARGET ConsoleControlExamples PROPERTY C_STANDARD 11)
set_property(TARGET ConsoleControlExamples PROPERTY C_STANDARD_REQUIRED ON)
message(STATUS "ConsoleControlExamples set standard to use: c11")
